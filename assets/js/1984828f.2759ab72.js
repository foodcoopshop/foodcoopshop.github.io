"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[93],{216:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var t=n(4848),r=n(8453);const s={displayed_sidebar:"mySidebar"},i="Webserver configuration",a={id:"dev/webserver-configuration",title:"Webserver configuration",description:"This page has not been updated for a long time.",source:"@site/docs/dev/webserver-configuration.md",sourceDirName:"dev",slug:"/dev/webserver-configuration",permalink:"/dev/webserver-configuration",draft:!1,unlisted:!1,editUrl:"https://github.com/foodcoopshop/foodcoopshop.github.io/edit/main/docs/dev/webserver-configuration.md",tags:[],version:"current",lastUpdatedAt:1710879114,formattedLastUpdatedAt:"19. M\xe4rz 2024",frontMatter:{displayed_sidebar:"mySidebar"},sidebar:"mySidebar"},c={},d=[{value:"Document Root / Virtual Host",id:"document-root--virtual-host",level:2},{value:"Nginx Webserver",id:"nginx-webserver",level:3},{value:"Apache Webserver",id:"apache-webserver",level:3}];function l(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"webserver-configuration",children:"Webserver configuration"}),"\n",(0,t.jsx)(o.admonition,{type:"info",children:(0,t.jsx)(o.p,{children:"This page has not been updated for a long time."})}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"Set the document root to: /your-folder/foodcoopshop/webroot"}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"document-root--virtual-host",children:"Document Root / Virtual Host"}),"\n",(0,t.jsx)(o.h3,{id:"nginx-webserver",children:"Nginx Webserver"}),"\n",(0,t.jsxs)(o.p,{children:["Nginx webserver doesn't have something like mod_rewrite or .htaccess. See ",(0,t.jsx)(o.a,{href:"https://book.cakephp.org/4/en/installation.html#url-rewriting",children:"https://book.cakephp.org/4/en/installation.html#url-rewriting"})," for details of preparing nginx to run cakephp-apps. The virtualhosts are configured in a similar manner under /etc/nginx/sites-avaliabe/xx symlinked to /etc/nginx/sites-enabled/xx and this would be a basic working virtualhost-sample for nginx with php7-fpm"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"server {\n    listen   80;\n    server_name your-foodcoops-hostname.net;\n\n    root   /var/www/your-foodcoops-hostname.net/webroot/;\n    index  index.php;\n\n    access_log /var/www/your-foodcoops-hostname.net/logs/access.log;\n    error_log /var/www/your-foodcoops-hostname.net/logs/error.log;\n\n    location / {\n        try_files $uri $uri/ /index.php?$args;\n    }\n\n    location ~ \\.php$ {\n        try_files $uri =404;\n        fastcgi_pass unix:/var/run/php/php7.3-fpm.sock;\n        include /etc/nginx/fastcgi_params;\n        fastcgi_index   index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    }\n}\n"})}),"\n",(0,t.jsx)(o.h3,{id:"apache-webserver",children:"Apache Webserver"}),"\n",(0,t.jsxs)(o.p,{children:['If you develop on your local machine, your virtual host should end with ".test" (e.g. foodcoopshop.test). Then development environment and correct debug mode are set automatically. Simply add the prefered hostname to your local hosts file (e.g. /etc/hosts). Check in your browser by loading ',(0,t.jsx)(o.a,{href:"http://foodcoopshop.test/",children:"http://foodcoopshop.test/"}),"."]}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsxs)(o.strong,{children:[(0,t.jsx)(o.code,{children:"mod_rewrite"})," needs to be enabled!"]})}),"\n",(0,t.jsx)(o.p,{children:"Create a new virtual host in your Apache configuration. Most common is copying /etc/apache2/sites-available/000-default.conf to 020-foodcoopshop.conf and symlinking it to /etc/apache2/sites-enabled:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"me@home:/etc/apache2/sites-available$ sudo cp 000-default.conf 020-foodcoopshop.conf\nme@home:/etc/apache2/sites-available$ sudo ln -sr 020-foodcoopshop.conf ../sites-enabled\n"})}),"\n",(0,t.jsx)(o.p,{children:"Now use your favourite editor to edit the new config file 020-foodcoopshop.conf (you must have root rights to edit):"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:["In the first line, set ",(0,t.jsx)(o.code,{children:"<VirtualHost *:80>"})," to your domain (e.g. ",(0,t.jsx)(o.code,{children:"<VirtualHost www.yourfoodcoop.com:80>"}),")"]}),"\n",(0,t.jsxs)(o.li,{children:["Set ",(0,t.jsx)(o.code,{children:"ServerAdmin"})," to a local mail account (e.g. root@localhost)"]}),"\n",(0,t.jsxs)(o.li,{children:["Set ",(0,t.jsx)(o.code,{children:"DocumentRoot"})," to /path/to/webroot (e.g. /var/www/foodcoopshop/webroot)"]}),"\n",(0,t.jsxs)(o.li,{children:["Add a ",(0,t.jsx)(o.code,{children:"<Directory>"})," section to allow public access and make .htaccess work:"]}),"\n"]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{children:"    <Directory /var/www/foodcoopshop/webroot>\n        Options FollowSymLinks MultiViews\n        AllowOverride All\n        Order allow,deny\n        allow from all\n    </Directory>\n"})}),"\n",(0,t.jsx)(o.p,{children:"Set the file access rights so that the Apache user (e.g. www-data) owns all files and folders:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"me@home:/var/www$ sudo chown -R www-data:www-data foodcoopshop\n"})}),"\n",(0,t.jsx)(o.p,{children:"Then restart the webserver:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"me@home:/etc/apache2/sites-available$ sudo service apache2 restart\n"})})]})}function h(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>a});var t=n(6540);const r={},s=t.createContext(r);function i(e){const o=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(s.Provider,{value:o},e.children)}}}]);